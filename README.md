#  Telegram Bot ‚Äî  Nginx, Php-fpm and MySQL ,Certbot


> –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π Telegram-–±–æ—Ç, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ —á–∏—Å—Ç–æ–º PHP –±–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, —Ä–∞–±–æ—Ç—É —Å –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, inline-–∫–Ω–æ–ø–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ webhook.

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Docker** –∏ **docker-compose**.
2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

  
```bash

git clone https://github.com/Darod103/telegram_bot.git

cd telegram_bot
```
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞:
```bash
cp .env.example .env
```

4. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª .env –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ:
   - TELEGRAM_BOT_TOKEN ‚Äî —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram-–±–æ—Ç–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —É [@BotFather](https://t.me/BotFather)
   - DB_HOST, DB_NAME, DB_USER, DB_PASSWORD ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - TELEGRAM_BOT_WEBHOOK_URL ‚Äî URL-–∞–¥—Ä–µ—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É Telegram –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã (–≤–∞—à –¥–æ–º–µ–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä: `https://yourdomain.com`)
   - TELEGRAM_BOT_LINK ‚Äî –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://t.me/YourBotName`)
5. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
     - –ó–∞–º–µ–Ω–∏—Ç–µ –¥–æ–º–µ–Ω—ã –∏ email –≤ —Ñ–∞–π–ª–µ init-letsencrypt.sh.
     - –ó–∞–º–µ–Ω–∏—Ç–µ –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è example.org –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω –≤ —Ñ–∞–π–ª–∞—Ö:
	     - config/nginx/app.conf
	     - config/nginx.localhost/app.conf
	 - –í docker-compose.yml:
	   - **–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** —Å—Ç—Ä–æ–∫—É - ./nginx.localhost:/etc/nginx/conf.d
	   - **–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** —Å—Ç—Ä–æ–∫—É - ./nginx:/etc/nginx/conf.d
	  - –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ:
```bash
chmod +x ./scripts/init-letsencrypt.sh

./scripts/init-letsencrypt.sh
```
> üí° –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ staging=1 –≤ —Å–∫—Ä–∏–ø—Ç–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Let‚Äôs Encrypt –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø—Ä–æ—Å–æ–≤.

6. –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:
   - **–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** —Å—Ç—Ä–æ–∫—É - ./nginx.localhost:/etc/nginx/conf.d
   - **–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** —Å—Ç—Ä–æ–∫—É - ./nginx:/etc/nginx/conf.d –≤ docker-compose.yml
  7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ 
   ```bash
docker-compose up --build -d
```
8. –ó–∞–ø—É—Å—Ç–∏—Ç–µ composer:
```bash
composer instal
```
9. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ö—É–∫–∞
```bash
php ./scripts/setWebHook.php 
```

### –ö–∞—Ç–∞–ª–æ–≥ `src`

  

–°–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ PHP:

**app/** ‚Äî –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –º–æ–¥–µ–ª–∏, —Ä–æ—É—Ç–µ—Ä—ã –∏ —Å–µ—Ä–≤–∏—Å—ã).

¬†    **Controller/** ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

¬†    **Model/** ‚Äî –ú–æ–¥–µ–ª–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).

¬†    **Router/** ‚Äî –†–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.

¬†   **Services/** ‚Äî –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–ª–∞—Å—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –∏ —Ä–∞–±–æ—Ç–∞ —Å API Telegram).
   **Core/** ‚Äî –ö–ª–∞—Å—Å—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —è–¥—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π).


### –ö–∞—Ç–∞–ª–æ–≥ `scripts`

  

–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:

  

- **init-letsencrypt.sh** ‚Äî –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –æ—Ç Let's Encrypt —Å –ø–æ–º–æ—â—å—é Certbot.

- **clearLogs.php**  ‚Äî –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

- **setWebHook.php** ‚Äî –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞ Telegram (–∑–∞–ø—É—Å–∫–∞–µ—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑).

  

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
